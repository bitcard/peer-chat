(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{164:function(module,exports,__webpack_require__){module.exports={component:"MessageList_component__T1NsJ",empty:"MessageList_empty__3_q-z"}},303:function(module,exports,__webpack_require__){module.exports={component:"UserHeader_component__20QYx",pulse:"UserHeader_pulse__22NGg"}},304:function(module,exports,__webpack_require__){module.exports={component:"UserList_component__svuzH",hint:"UserList_hint__3gWzW",online:"UserList_online__106Hf"}},305:function(module,exports,__webpack_require__){module.exports={component:"Message_component__3zNqu",online:"Message_online__X-RT1"}},307:function(module,exports,__webpack_require__){module.exports={component:"CreateMessageForm_component__35sSt"}},308:function(module,exports,__webpack_require__){module.exports={component:"RoomList_component__b_v_S"}},309:function(module,exports,__webpack_require__){module.exports={component:"RoomHeader_component__2p9iP"}},310:function(module,exports,__webpack_require__){module.exports={component:"CreateRoomForm_component__3PqcB"}},311:function(module,exports,__webpack_require__){module.exports={component:"WelcomeScreen_component__3yqm3",pulse:"WelcomeScreen_pulse__1-ohf"}},312:function(module,exports,__webpack_require__){module.exports={component:"JoinRoomScreen_component__1M5p7",pulse:"JoinRoomScreen_pulse__2vl5O"}},313:function(module,exports,__webpack_require__){module.exports={component:"RegisterScreen_component__1ToVO",pulse:"RegisterScreen_pulse__1Qecl"}},314:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return displayTests});var displayTests=describe("Display",function(){it("Shows the list of Agents in the room",function(){expect(!0)})})},315:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return displayFullNameTests});var displayFullNameTests=describe("Display with Full Name",function(){it("Shows the list of Agents in the room with a Full Name on one",function(){expect(!0)})})},316:function(module,__webpack_exports__,__webpack_require__){"use strict";var slicedToArray=__webpack_require__(317),defineProperty=__webpack_require__(25),objectSpread=__webpack_require__(12),classCallCheck=__webpack_require__(300),createClass=__webpack_require__(301),possibleConstructorReturn=__webpack_require__(318),getPrototypeOf=__webpack_require__(302),inherits=__webpack_require__(319),react=__webpack_require__(0),react_default=__webpack_require__.n(react),react_dom=__webpack_require__(162),react_dom_default=__webpack_require__.n(react_dom),lib=(__webpack_require__(670),__webpack_require__(163)),UserHeader=__webpack_require__(77),UserList=__webpack_require__(78),index_module=__webpack_require__(164),index_module_default=__webpack_require__.n(index_module),Message_index_module=__webpack_require__(305),Message_index_module_default=__webpack_require__.n(Message_index_module),Linkify=__webpack_require__(306),Linkify_default=__webpack_require__.n(Linkify),Message_Message=function Message(_ref){_ref.user;var users=_ref.users;return function(message){var profile=users[message.sender]||{name:"?",avatar_url:""};return message.sender?react_default.a.createElement("li",{key:message.id,className:Message_index_module_default.a.component},react_default.a.createElement("img",{src:profile.avatar_url,alt:profile.name[0]}),react_default.a.createElement("div",null,react_default.a.createElement("span",null,"".concat(profile.name," | ").concat(function time(timestamp){var date=new Date(1e3*timestamp),minutes=date.getMinutes();return"".concat(date.getHours(),":").concat(minutes<10?"0"+minutes:minutes)}(message.createdAt))),react_default.a.createElement("p",null,react_default.a.createElement(Linkify_default.a,{properties:{target:"_blank"}},message.text)))):null}},emptyList=react_default.a.createElement("div",{className:index_module_default.a.empty},react_default.a.createElement("span",{role:"img","aria-label":"post"},"📝"),react_default.a.createElement("h2",null,"No Messages Yet"),react_default.a.createElement("p",null,"Be the first to post in this room!")),MessageList_MessageList=function MessageList(_ref){var _ref$messages=_ref.messages,messages=void 0===_ref$messages?[]:_ref$messages,user=_ref.user,users=_ref.users,createConvo=_ref.createConvo;return react_default.a.createElement("ul",{id:"messages",className:index_module_default.a.component},messages.length>0?react_default.a.createElement("wrapper-",null,messages.sort(function(a,b){return b.createdAt-a.createdAt}).map(function(message){return Message_Message({user:user,createConvo:createConvo,users:users})(message)})):emptyList)};MessageList_MessageList.__docgenInfo={description:"",methods:[],displayName:"MessageList"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/MessageList/index.js"]={name:"MessageList",docgenInfo:MessageList_MessageList.__docgenInfo,path:"src/components/MessageList/index.js"});var CreateMessageForm_index_module=__webpack_require__(307),CreateMessageForm_index_module_default=__webpack_require__.n(CreateMessageForm_index_module),CreateMessageForm_CreateMessageForm=function CreateMessageForm(_ref){var _ref$state=_ref.state,_ref$state$room=(_ref$state.user,_ref$state.room),room=void 0===_ref$state$room?{}:_ref$state$room,_ref$actions=(_ref$state.message,_ref.actions),sendMessage=_ref$actions.sendMessage,runCommand=_ref$actions.runCommand,getMessages=_ref$actions.getMessages;return room.id?react_default.a.createElement("form",{className:CreateMessageForm_index_module_default.a.component,onSubmit:function onSubmit(e){e.preventDefault();var message=e.target[0].value.trim();0!==message.length&&(e.target[0].value="",message.startsWith("/")?runCommand(message.slice(1)):sendMessage({text:message,roomId:room.id}))}},react_default.a.createElement("input",{placeholder:"Type a Message.."}),react_default.a.createElement("button",{type:"submit"},react_default.a.createElement("svg",null,react_default.a.createElement("use",{xlinkHref:"index.svg#send"}))),react_default.a.createElement("button",{type:"submit",onClick:function onClick(){return getMessages(room.id)}},react_default.a.createElement("img",{src:"refresh.svg",alt:""}))):null};CreateMessageForm_CreateMessageForm.__docgenInfo={description:"",methods:[],displayName:"CreateMessageForm"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/CreateMessageForm/index.js"]={name:"CreateMessageForm",docgenInfo:CreateMessageForm_CreateMessageForm.__docgenInfo,path:"src/components/CreateMessageForm/index.js"});var RoomList_index_module=__webpack_require__(308),RoomList_index_module_default=__webpack_require__.n(RoomList_index_module),RoomList_RoomList=function RoomList(_ref){var refresh,_ref$rooms=_ref.rooms,rooms=void 0===_ref$rooms?[]:_ref$rooms,user=_ref.user,messages=_ref.messages,current=_ref.current,actions=_ref.actions;return refresh=user.id?react_default.a.createElement("li",{onClick:actions.getRooms},react_default.a.createElement("input",{id:"refresh",type:"image",alt:"refresh",src:"refresh.svg"})):react_default.a.createElement("li",null),react_default.a.createElement("ul",{className:RoomList_index_module_default.a.component},rooms.map(function(room){var messageKeys=Object.keys(messages[room.id]||{}),latestMessage=messageKeys.length>0&&messages[room.id][messageKeys.pop()],firstUser=room.users.find(function(x){return x.id!==user.id});return react_default.a.createElement("li",{key:room.id,disabled:room.id===current.id,onClick:function onClick(e){return actions.joinRoom(room)}},room.name.match(user.id)&&firstUser?react_default.a.createElement("img",{src:firstUser.avatarURL,alt:firstUser.id}):function Icon(id){return react_default.a.createElement("svg",null,react_default.a.createElement("use",{xlinkHref:"index.svg#".concat(id)}))}(room.isPrivate?"lock":"public"),react_default.a.createElement("col-",null,react_default.a.createElement("p",null,room.name.replace(user.id,"")),react_default.a.createElement("span",null,latestMessage&&latestMessage.text)))}),refresh)};RoomList_RoomList.__docgenInfo={description:"",methods:[],displayName:"RoomList"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/RoomList/index.js"]={name:"RoomList",docgenInfo:RoomList_RoomList.__docgenInfo,path:"src/components/RoomList/index.js"});var RoomHeader_index_module=__webpack_require__(309),RoomHeader_index_module_default=__webpack_require__.n(RoomHeader_index_module),RoomHeader_RoomHeader=function RoomHeader(_ref){var _ref$state=_ref.state,room=_ref$state.room,user=_ref$state.user,sidebarOpen=_ref$state.sidebarOpen,userListOpen=_ref$state.userListOpen,_ref$actions=_ref.actions,setSidebar=_ref$actions.setSidebar,setUserList=_ref$actions.setUserList;return react_default.a.createElement("header",{className:RoomHeader_index_module_default.a.component},react_default.a.createElement("button",{onClick:function onClick(e){return setSidebar(!sidebarOpen)}},react_default.a.createElement("svg",null,react_default.a.createElement("use",{xlinkHref:"index.svg#menu"}))),react_default.a.createElement("h1",null,room.name&&room.name.replace(user.id,"")),room.users&&react_default.a.createElement("div",{onClick:function onClick(e){return setUserList(!userListOpen)}},react_default.a.createElement("span",null,room.users.length),react_default.a.createElement("svg",null,react_default.a.createElement("use",{xlinkHref:"index.svg#members"}))))};RoomHeader_RoomHeader.__docgenInfo={description:"",methods:[],displayName:"RoomHeader"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/RoomHeader/index.js"]={name:"RoomHeader",docgenInfo:RoomHeader_RoomHeader.__docgenInfo,path:"src/components/RoomHeader/index.js"});var CreateRoomForm_index_module=__webpack_require__(310),CreateRoomForm_index_module_default=__webpack_require__.n(CreateRoomForm_index_module),CreateRoomForm_CreateRoomForm=function CreateRoomForm(_ref){var submit=_ref.submit;return react_default.a.createElement("form",{className:CreateRoomForm_index_module_default.a.component,onSubmit:function onSubmit(e){e.preventDefault();var name=e.target[0].value;0!==name.length&&(submit({name:name}),e.target[0].value="")}},react_default.a.createElement("input",{id:"room",placeholder:"Create a Room"}),react_default.a.createElement("button",{id:"submit",type:"submit"},react_default.a.createElement("svg",null,react_default.a.createElement("use",{xlinkHref:"index.svg#add"}))))};CreateRoomForm_CreateRoomForm.__docgenInfo={description:"",methods:[],displayName:"CreateRoomForm"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/CreateRoomForm/index.js"]={name:"CreateRoomForm",docgenInfo:CreateRoomForm_CreateRoomForm.__docgenInfo,path:"src/components/CreateRoomForm/index.js"});var WelcomeScreen_index_module=__webpack_require__(311),WelcomeScreen_index_module_default=__webpack_require__.n(WelcomeScreen_index_module),WelcomeScreen_WelcomeScreen=function WelcomeScreen(_ref){var message=_ref.message;return react_default.a.createElement("section",null,react_default.a.createElement("div",{className:WelcomeScreen_index_module_default.a.component},react_default.a.createElement("span",{role:"img","aria-label":"post"},react_default.a.createElement("svg",{viewBox:"0 0 59 80"},react_default.a.createElement("g",null,react_default.a.createElement("path",{d:"M48.417 49.444L38.585 73.229 36.012 71.394 41.802 56.726 31.211 59.519C31.211 59.519 26.022 42.42 26.513 30.837 26.218 22.744 27.644 16.96 30.167 13.6 34.274 8.408 42.099 3.953 49.793 7.645 54.701 9.869 57.658 13.889 58.107 17.824 59.479 34.859 38.498 41.817 38.498 41.817L38.085 38.191C38.085 38.191 44.945 35.464 49.105 29.553 53.266 23.643 51.245 15.88 46.569 14.464 42.061 13.577 37.34 18.757 36.516 27.966 34.721 41.776 39.393 52.006 39.393 52.006L48.417 49.444M0 62.396L15.402 74.372 16.522 71.783 8.26 65.71 16.853 63.305C16.853 63.305 10.998 47.535 10.597 32.251 10.229 27.354 9.896 11.684 15.924 8.975 16.976 7.213 18.743 5.903 18.743 5.903 18.743 5.903 3.467 4.584 4.184 32.453 5.706 51.166 9.451 59.821 9.451 59.821L0 62.396"}),react_default.a.createElement("path",{d:"M29.91,61.761 L38.969,59.263 L30.045,80 L11.998,66.538 L19.098,64.644 C19.098,64.644 3.276,20.694 21.128,5.095 C32.325,-3.789 43.164,3.999 42.965,4.872 C40.203,4.812 37.842,5.844 37.842,5.844 C37.842,5.844 31.789,3.265 27.475,12.503 C23.719,20.705 22.048,34.474 29.91,61.761"}),react_default.a.createElement("path",{d:"M41.806,17.606 C42.599,24.356 38.244,27.206 38.244,27.206 L37.819,30.659 C37.819,30.659 47.709,25.549 45.669,15.819 C44.566,15.913 42.212,17.242 41.806,17.606"})))),react_default.a.createElement("p",null,message)))};WelcomeScreen_WelcomeScreen.__docgenInfo={description:"",methods:[],displayName:"WelcomeScreen"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/WelcomeScreen/index.js"]={name:"WelcomeScreen",docgenInfo:WelcomeScreen_WelcomeScreen.__docgenInfo,path:"src/components/WelcomeScreen/index.js"});var JoinRoomScreen_index_module=__webpack_require__(312),JoinRoomScreen_index_module_default=__webpack_require__.n(JoinRoomScreen_index_module),JoinRoomScreen_JoinRoomScreen=function JoinRoomScreen(){return react_default.a.createElement("section",null,react_default.a.createElement("div",{className:JoinRoomScreen_index_module_default.a.component},react_default.a.createElement("span",{role:"img","aria-label":"post"},react_default.a.createElement("svg",{viewBox:"0 0 59 80"},react_default.a.createElement("g",null,react_default.a.createElement("path",{d:"M48.417 49.444L38.585 73.229 36.012 71.394 41.802 56.726 31.211 59.519C31.211 59.519 26.022 42.42 26.513 30.837 26.218 22.744 27.644 16.96 30.167 13.6 34.274 8.408 42.099 3.953 49.793 7.645 54.701 9.869 57.658 13.889 58.107 17.824 59.479 34.859 38.498 41.817 38.498 41.817L38.085 38.191C38.085 38.191 44.945 35.464 49.105 29.553 53.266 23.643 51.245 15.88 46.569 14.464 42.061 13.577 37.34 18.757 36.516 27.966 34.721 41.776 39.393 52.006 39.393 52.006L48.417 49.444M0 62.396L15.402 74.372 16.522 71.783 8.26 65.71 16.853 63.305C16.853 63.305 10.998 47.535 10.597 32.251 10.229 27.354 9.896 11.684 15.924 8.975 16.976 7.213 18.743 5.903 18.743 5.903 18.743 5.903 3.467 4.584 4.184 32.453 5.706 51.166 9.451 59.821 9.451 59.821L0 62.396"}),react_default.a.createElement("path",{d:"M29.91,61.761 L38.969,59.263 L30.045,80 L11.998,66.538 L19.098,64.644 C19.098,64.644 3.276,20.694 21.128,5.095 C32.325,-3.789 43.164,3.999 42.965,4.872 C40.203,4.812 37.842,5.844 37.842,5.844 C37.842,5.844 31.789,3.265 27.475,12.503 C23.719,20.705 22.048,34.474 29.91,61.761"}),react_default.a.createElement("path",{d:"M41.806,17.606 C42.599,24.356 38.244,27.206 38.244,27.206 L37.819,30.659 C37.819,30.659 47.709,25.549 45.669,15.819 C44.566,15.913 42.212,17.242 41.806,17.606"})))),react_default.a.createElement("p",null,"Join a room from the left or create a new room using the field on the bottom left")))};JoinRoomScreen_JoinRoomScreen.__docgenInfo={description:"",methods:[],displayName:"JoinRoomScreen"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/JoinRoomScreen/index.js"]={name:"JoinRoomScreen",docgenInfo:JoinRoomScreen_JoinRoomScreen.__docgenInfo,path:"src/components/JoinRoomScreen/index.js"});var RegisterScreen_index_module=__webpack_require__(313),RegisterScreen_index_module_default=__webpack_require__.n(RegisterScreen_index_module),RegisterScreen_RegisterScreen=function RegisterScreen(_ref){var registerUser=_ref.registerUser;return react_default.a.createElement("section",null,react_default.a.createElement("div",{className:RegisterScreen_index_module_default.a.component},react_default.a.createElement("span",{role:"img","aria-label":"post"},react_default.a.createElement("svg",{viewBox:"0 0 59 80"},react_default.a.createElement("g",null,react_default.a.createElement("path",{d:"M48.417 49.444L38.585 73.229 36.012 71.394 41.802 56.726 31.211 59.519C31.211 59.519 26.022 42.42 26.513 30.837 26.218 22.744 27.644 16.96 30.167 13.6 34.274 8.408 42.099 3.953 49.793 7.645 54.701 9.869 57.658 13.889 58.107 17.824 59.479 34.859 38.498 41.817 38.498 41.817L38.085 38.191C38.085 38.191 44.945 35.464 49.105 29.553 53.266 23.643 51.245 15.88 46.569 14.464 42.061 13.577 37.34 18.757 36.516 27.966 34.721 41.776 39.393 52.006 39.393 52.006L48.417 49.444M0 62.396L15.402 74.372 16.522 71.783 8.26 65.71 16.853 63.305C16.853 63.305 10.998 47.535 10.597 32.251 10.229 27.354 9.896 11.684 15.924 8.975 16.976 7.213 18.743 5.903 18.743 5.903 18.743 5.903 3.467 4.584 4.184 32.453 5.706 51.166 9.451 59.821 9.451 59.821L0 62.396"}),react_default.a.createElement("path",{d:"M29.91,61.761 L38.969,59.263 L30.045,80 L11.998,66.538 L19.098,64.644 C19.098,64.644 3.276,20.694 21.128,5.095 C32.325,-3.789 43.164,3.999 42.965,4.872 C40.203,4.812 37.842,5.844 37.842,5.844 C37.842,5.844 31.789,3.265 27.475,12.503 C23.719,20.705 22.048,34.474 29.91,61.761"}),react_default.a.createElement("path",{d:"M41.806,17.606 C42.599,24.356 38.244,27.206 38.244,27.206 L37.819,30.659 C37.819,30.659 47.709,25.549 45.669,15.819 C44.566,15.913 42.212,17.242 41.806,17.606"})))),react_default.a.createElement("p",null,"It looks like this is the first time using chat with this agent. Register a handle and avatar for this agent ID."),react_default.a.createElement("form",{onSubmit:function onSubmit(e){e.preventDefault();var name=e.target[0].value,avatarURL=e.target[1].value;0!==name.length&&registerUser({name:name,avatarURL:avatarURL})}},react_default.a.createElement("input",{id:"handle",placeholder:"input @handle"}),react_default.a.createElement("br",null),react_default.a.createElement("input",{id:"avatar",placeholder:"paste url for avatar image"}),react_default.a.createElement("br",null),react_default.a.createElement("button",{id:"submit",type:"submit"},"Register!"))))};RegisterScreen_RegisterScreen.__docgenInfo={description:"",methods:[],displayName:"RegisterScreen"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/RegisterScreen/index.js"]={name:"RegisterScreen",docgenInfo:RegisterScreen_RegisterScreen.__docgenInfo,path:"src/components/RegisterScreen/index.js"}),__webpack_require__.d(__webpack_exports__,"a",function(){return src_View});var REACT_APP_CHAT_WEBSOCKET_INTERFACE=Object({NODE_ENV:"production",NODE_PATH:"/nix/store/j4cydbiwg9m21nd5gjgawrid9lp4yg7l-nodejs-11.14.0/lib/node_modules:/nix/store/j4cydbiwg9m21nd5gjgawrid9lp4yg7l-nodejs-11.14.0/lib/node_modules",PUBLIC_URL:"."}).REACT_APP_CHAT_WEBSOCKET_INTERFACE,REACT_APP_PERSONAS_URL=Object({NODE_ENV:"production",NODE_PATH:"/nix/store/j4cydbiwg9m21nd5gjgawrid9lp4yg7l-nodejs-11.14.0/lib/node_modules:/nix/store/j4cydbiwg9m21nd5gjgawrid9lp4yg7l-nodejs-11.14.0/lib/node_modules",PUBLIC_URL:"."}).REACT_APP_PERSONAS_URL;console.log(REACT_APP_CHAT_WEBSOCKET_INTERFACE);var src_View=function(_React$Component){function View(props){var _this;return Object(classCallCheck.a)(this,View),(_this=Object(possibleConstructorReturn.a)(this,Object(getPrototypeOf.a)(View).call(this,props))).state=REACT_APP_CHAT_WEBSOCKET_INTERFACE?{holochainConnection:Object(lib.connect)({url:REACT_APP_CHAT_WEBSOCKET_INTERFACE}),connected:!1,user:{},users:{},room:{},rooms:[],messages:{},sidebarOpen:!1,userListOpen:window.innerWidth>1e3,profileSpecSourceDna:""}:{holochainConnection:Object(lib.connect)(),connected:!1,user:{},users:{},room:{},rooms:[],messages:{},sidebarOpen:!1,userListOpen:window.innerWidth>1e3,profileSpecSourceDna:""},_this.actions={setSidebar:function setSidebar(sidebarOpen){return _this.setState({sidebarOpen:sidebarOpen})},setUserList:function setUserList(userListOpen){return _this.setState({userListOpen:userListOpen})},setUser:function setUser(user){_this.setState({user:user}),_this.actions.getRooms()},setRoom:function setRoom(room){_this.setState({room:room,sidebarOpen:!1}),_this.actions.getMessages(room.id),_this.actions.getRoomMembers(room.id),_this.actions.scrollToEnd()},joinRoom:function joinRoom(room){console.log("joining room"),_this.actions.setRoom(room),_this.makeHolochainCall("holo-chat/chat/join_stream",{stream_address:room.id},function(result){console.log("joined room",result)})},getRoomMembers:function getRoomMembers(roomId){_this.makeHolochainCall("holo-chat/chat/get_members",{stream_address:roomId},function(result){console.log("retrieved members",result);var users=result.Ok;users.forEach(function(address){_this.actions.getUserProfile(address)}),_this.setState({room:Object(objectSpread.a)({},_this.state.room,{users:users})})})},sendMessage:function sendMessage(_ref){var text=_ref.text,roomId=_ref.roomId,message={message_type:"text",timestamp:Math.floor(Date.now()/1e3),payload:text,meta:""};_this.makeHolochainCall("holo-chat/chat/post_message",{stream_address:roomId,message:message},function(result){console.log("message posted",result),_this.actions.getMessages(roomId),_this.actions.scrollToEnd()})},getMessages:function getMessages(roomId){_this.makeHolochainCall("holo-chat/chat/get_messages",{address:roomId},function(result){console.log("retrieved messages",result);var roomMessages=result.Ok.map(function(_ref2){var address=_ref2.address,entry=_ref2.entry;return{text:entry.payload,sender:entry.author,createdAt:entry.timestamp,id:address}});_this.setState({messages:Object(objectSpread.a)({},_this.state.messages,Object(defineProperty.a)({},roomId,roomMessages))})})},createRoom:function createRoom(options){console.log(options);var roomSpec={name:options.name,description:"",initial_members:[]};_this.makeHolochainCall("holo-chat/chat/create_stream",roomSpec,function(result){console.log("created room",result),_this.actions.setRoom({id:result.Ok,name:options.name,users:[]}),_this.actions.getRooms()})},getUserProfile:function getUserProfile(userId){_this.makeHolochainCall("holo-chat/chat/get_member_profile",{agent_address:userId},function(result){console.log("retrieved profile",result),_this.setState({users:Object(objectSpread.a)({},_this.state.users,Object(defineProperty.a)({},userId,result.Ok))})})},setFirstName:function setFirstName(userId){console.log("Asked for First Name"),_this.makeHolochainCall("holo-chat/chat/get_full_name",{agent_address:userId},function(result){var name=result.Ok.body,user=_this.state.users[userId];user.full_name=name,console.log(user),_this.setState({users:Object(objectSpread.a)({},_this.state.users,Object(defineProperty.a)({},userId,user))}),console.log("Asked for First Name",result.Ok.body)})},getRooms:function getRooms(){_this.makeHolochainCall("holo-chat/chat/get_all_public_streams",{},function(result){console.log("retrieved public rooms",result);var rooms=result.Ok.map(function(_ref3){var address=_ref3.address,entry=_ref3.entry;return{id:address,private:!entry.public,name:entry.name,users:[]}});_this.setState({rooms:rooms})})},registerUser:function registerUser(_ref4){var name=_ref4.name,avatarURL=_ref4.avatarURL;_this.makeHolochainCall("holo-chat/chat/register",{name:name,avatar_url:avatarURL},function(result){console.log("registered user",result),_this.actions.setUser({id:result.Ok,name:name,avatarURL:avatarURL})})},scrollToEnd:function scrollToEnd(e){return setTimeout(function(){var elem=document.querySelector("#messages");elem&&(elem.scrollTop=1e5)},0)}},_this}return Object(inherits.a)(View,_React$Component),Object(createClass.a)(View,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;this.state.holochainConnection.then(function(_ref5){var callZome=_ref5.callZome,call=_ref5.call,onSignal=_ref5.onSignal;_this2.setState({connected:!0}),onSignal(function(signal){if(console.log(JSON.stringify(signal.signal)),"new_message"===signal.signal.name){console.log(JSON.stringify(signal.signal.name));var roomId=JSON.parse(signal.signal.arguments).roomId;console.log(JSON.parse(signal.signal.arguments)),console.log(roomId),_this2.actions.getMessages(roomId)}else if("new_room_member"===signal.signal.name){console.log(JSON.stringify(signal.signal.name));var _roomId=JSON.parse(signal.signal.arguments).roomId;_this2.actions.getRoomMembers(_roomId)}}),call("admin/interface/list")({}).then(function(result){console.log(result)}),callZome("holo-chat","chat","get_my_member_profile")({}).then(function(result){var profile=JSON.parse(result).Ok;if(profile)console.log("registration user found with profile:",profile),_this2.actions.setUser({id:profile.address,name:profile.name,avatarURL:profile.avatar_url});else{var profileSpecSourceDna=JSON.parse(result).Err.Internal;console.log("User has not registered a profile. redirecting to p&p "+JSON.stringify(profileSpecSourceDna)),window.location.replace("".concat(REACT_APP_PERSONAS_URL,"/profile/").concat(profileSpecSourceDna,"/").concat(encodeURIComponent(window.location.href)))}})})}},{key:"makeHolochainCall",value:function makeHolochainCall(callString,params,callback){var _callString$split=callString.split("/"),_callString$split2=Object(slicedToArray.a)(_callString$split,3),instanceId=_callString$split2[0],zome=_callString$split2[1],func=_callString$split2[2];this.state.holochainConnection.then(function(_ref6){(0,_ref6.callZome)(instanceId,zome,func)(params).then(function(result){return callback(JSON.parse(result))})})}},{key:"render",value:function render(){var _this$state=this.state,user=_this$state.user,users=_this$state.users,room=_this$state.room,rooms=_this$state.rooms,messages=_this$state.messages,sidebarOpen=_this$state.sidebarOpen,userListOpen=_this$state.userListOpen,connected=_this$state.connected,_this$actions=this.actions,createRoom=_this$actions.createRoom,registerUser=_this$actions.registerUser;return react_default.a.createElement("main",null,react_default.a.createElement("aside",{"data-open":sidebarOpen},react_default.a.createElement(UserHeader.a,{state:this.state,actions:this.actions}),react_default.a.createElement(RoomList_RoomList,{user:user,rooms:rooms,messages:messages,current:room,actions:this.actions}),user.id&&react_default.a.createElement(CreateRoomForm_CreateRoomForm,{submit:createRoom})),react_default.a.createElement("section",null,react_default.a.createElement(RoomHeader_RoomHeader,{state:this.state,actions:this.actions}),room.id?react_default.a.createElement("row-",null,react_default.a.createElement("col-",null,react_default.a.createElement(MessageList_MessageList,{user:user,users:users,messages:messages[room.id]}),react_default.a.createElement(CreateMessageForm_CreateMessageForm,{state:this.state,actions:this.actions})),userListOpen&&react_default.a.createElement(UserList.a,{state:this.state,actions:this.actions})):connected?user.id?react_default.a.createElement(JoinRoomScreen_JoinRoomScreen,null):react_default.a.createElement(RegisterScreen_RegisterScreen,{registerUser:registerUser}):react_default.a.createElement(WelcomeScreen_WelcomeScreen,{message:"Connecting to Holochain... Make sure the conductor is running and try refreshing the page"})))}}]),View}(react_default.a.Component);react_dom_default.a.render(react_default.a.createElement(src_View,null),document.querySelector("#root"))},320:function(module,exports,__webpack_require__){__webpack_require__(321),__webpack_require__(424),module.exports=__webpack_require__(425)},425:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(module){var _storybook_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(36),req=(__webpack_require__(637),__webpack_require__(668));Object(_storybook_react__WEBPACK_IMPORTED_MODULE_0__.configure)(function loadStories(){req.keys().forEach(function(filename){return req(filename)})},module)}.call(this,__webpack_require__(90)(module))},637:function(module,__webpack_exports__,__webpack_require__){"use strict";var storybook_addon_specifications__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(24),expect__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(298),expect__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(expect__WEBPACK_IMPORTED_MODULE_1__),jest_mock__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(299),jest_mock__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(jest_mock__WEBPACK_IMPORTED_MODULE_2__);window.describe=storybook_addon_specifications__WEBPACK_IMPORTED_MODULE_0__.describe,window.beforeEach=storybook_addon_specifications__WEBPACK_IMPORTED_MODULE_0__.beforeEach,window.it=storybook_addon_specifications__WEBPACK_IMPORTED_MODULE_0__.it,window.expect=expect__WEBPACK_IMPORTED_MODULE_1___default.a,window.jest=jest_mock__WEBPACK_IMPORTED_MODULE_2___default.a},668:function(module,exports,__webpack_require__){var map={"./_welcome/welcome.stories.js":669,"./components/UserHeader/index.stories.js":708,"./components/UserList/index.stories.js":713};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=668},669:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(module){var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),_storybook_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(36),_index__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(316);Object(_storybook_react__WEBPACK_IMPORTED_MODULE_1__.storiesOf)("Welcome",module).add("Home Page",function(){return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_index__WEBPACK_IMPORTED_MODULE_2__.a,null)})}.call(this,__webpack_require__(90)(module))},670:function(module,exports,__webpack_require__){},708:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(module){var _Users_philipbeadle_holochain_hApps_holochain_basic_chat_ui_src_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(12),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__),_storybook_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(36),_sambego_storybook_state__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(57),_index__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(77),props={state:{connected:!1,user:{avatarURL:"https://avatars3.githubusercontent.com/u/5264862?s=40&v=4",name:"@philt3r",id:"https://avatars3.githubusercontent.com/u/5264862?s=40&v=4",firstName:"",lastName:""},users:{},room:{},rooms:[],messages:{},openFullName:!1,userListOpen:window.innerWidth>1e3,profileSpecSourceDna:""},actions:{}},store=new _sambego_storybook_state__WEBPACK_IMPORTED_MODULE_3__.Store({props:props});Object(_storybook_react__WEBPACK_IMPORTED_MODULE_2__.storiesOf)("User Header",module).addDecorator(Object(_sambego_storybook_state__WEBPACK_IMPORTED_MODULE_3__.StateDecorator)(store)).add("Display - User",function(){return react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_index__WEBPACK_IMPORTED_MODULE_4__.a,props)}).add("Display - No User",function(){var newState=Object(_Users_philipbeadle_holochain_hApps_holochain_basic_chat_ui_src_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__.a)({},store.get("props").state,{user:{}});console.log(newState),store.set({props:Object(_Users_philipbeadle_holochain_hApps_holochain_basic_chat_ui_src_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__.a)({},props,{state:newState})}),console.log(store.get("props"));var newProps=store.get("props");return react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_index__WEBPACK_IMPORTED_MODULE_4__.a,newProps)})}.call(this,__webpack_require__(90)(module))},713:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(module){var _Users_philipbeadle_holochain_hApps_holochain_basic_chat_ui_src_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(25),_Users_philipbeadle_holochain_hApps_holochain_basic_chat_ui_src_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(12),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_2__),_storybook_react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(36),_sambego_storybook_state__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(57),storybook_addon_specifications__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(24),_index__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(78),_display_test__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(314),_displayFullName_test__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(315),props={state:{room:{id:"QmVQC9Fno8QFXgnW9i5tNdabcKxtTeXYXPeecK2qjn8bDx",private:!0,name:"Holochain Meetup - Melbourne",users:["HcSCIUKodbWktcbmwyAaVrYnsbadi6b9sOV9D4ZoE8i333ZtcGw38Jn3U6u63qi","HcSCJbpm8CZparb6f5iEKKRv4Te4op93q6ESMRuDtwp9abbzV8zYTF7EKqqw9ei"]},users:{HcSCIUKodbWktcbmwyAaVrYnsbadi6b9sOV9D4ZoE8i333ZtcGw38Jn3U6u63qi:{name:"Art",avatar_url:"https://avatars1.githubusercontent.com/u/117967?s=60&v=4",address:"HcSCIUKodbWktcbmwyAaVrYnsbadi6b9sOV9D4ZoE8i333ZtcGw38Jn3U6u63qi"},HcSCJbpm8CZparb6f5iEKKRv4Te4op93q6ESMRuDtwp9abbzV8zYTF7EKqqw9ei:{name:"@philt3r",avatar_url:"https://avatars0.githubusercontent.com/u/5264862?s=60&v=4",address:"HcSCJbpm8CZparb6f5iEKKRv4Te4op93q6ESMRuDtwp9abbzV8zYTF7EKqqw9ei"}}},actions:{setFirstName:function setFirstName(userId){console.log(userId);var user=Object(_Users_philipbeadle_holochain_hApps_holochain_basic_chat_ui_src_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__.a)({},props.state.users[userId],{full_name:"Full Name"}),users=Object(_Users_philipbeadle_holochain_hApps_holochain_basic_chat_ui_src_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__.a)({},props.state.users,Object(_Users_philipbeadle_holochain_hApps_holochain_basic_chat_ui_src_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__.a)({},userId,user));store.set({state:Object(_Users_philipbeadle_holochain_hApps_holochain_basic_chat_ui_src_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__.a)({},props.state,{users:users})})}}},store=new _sambego_storybook_state__WEBPACK_IMPORTED_MODULE_4__.Store({state:props.state,actions:props.actions});Object(_storybook_react__WEBPACK_IMPORTED_MODULE_3__.storiesOf)("User List",module).addDecorator(Object(_sambego_storybook_state__WEBPACK_IMPORTED_MODULE_4__.StateDecorator)(store)).add("Display",function(){Object(storybook_addon_specifications__WEBPACK_IMPORTED_MODULE_5__.specs)(function(){return _display_test__WEBPACK_IMPORTED_MODULE_7__.a});var users=Object(_Users_philipbeadle_holochain_hApps_holochain_basic_chat_ui_src_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__.a)({},props.state.users,Object(_Users_philipbeadle_holochain_hApps_holochain_basic_chat_ui_src_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__.a)({},"HcSCJbpm8CZparb6f5iEKKRv4Te4op93q6ESMRuDtwp9abbzV8zYTF7EKqqw9ei",{name:"@philt3r",avatar_url:"https://avatars0.githubusercontent.com/u/5264862?s=60&v=4",address:"HcSCJbpm8CZparb6f5iEKKRv4Te4op93q6ESMRuDtwp9abbzV8zYTF7EKqqw9ei"}));return store.set({state:Object(_Users_philipbeadle_holochain_hApps_holochain_basic_chat_ui_src_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__.a)({},props.state,{users:users})}),react__WEBPACK_IMPORTED_MODULE_2___default.a.createElement(_index__WEBPACK_IMPORTED_MODULE_6__.a,store.get("props"))}).add("Display with Full Name",function(){Object(storybook_addon_specifications__WEBPACK_IMPORTED_MODULE_5__.specs)(function(){return _displayFullName_test__WEBPACK_IMPORTED_MODULE_8__.a});var users=Object(_Users_philipbeadle_holochain_hApps_holochain_basic_chat_ui_src_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__.a)({},props.state.users,Object(_Users_philipbeadle_holochain_hApps_holochain_basic_chat_ui_src_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__.a)({},"HcSCJbpm8CZparb6f5iEKKRv4Te4op93q6ESMRuDtwp9abbzV8zYTF7EKqqw9ei",{name:"@philt3r",avatar_url:"https://avatars0.githubusercontent.com/u/5264862?s=60&v=4",address:"HcSCJbpm8CZparb6f5iEKKRv4Te4op93q6ESMRuDtwp9abbzV8zYTF7EKqqw9ei",full_name:"Philip Beadle"}));return store.set({state:Object(_Users_philipbeadle_holochain_hApps_holochain_basic_chat_ui_src_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__.a)({},props.state,{users:users})}),react__WEBPACK_IMPORTED_MODULE_2___default.a.createElement(_index__WEBPACK_IMPORTED_MODULE_6__.a,store.get("props"))})}.call(this,__webpack_require__(90)(module))},77:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return UserHeader});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),_index_module_css__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(303),_index_module_css__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_index_module_css__WEBPACK_IMPORTED_MODULE_1__),UserHeader=function UserHeader(_ref){var _ref$state$user=_ref.state.user,user=void 0===_ref$state$user?{}:_ref$state$user;return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("header",{className:_index_module_css__WEBPACK_IMPORTED_MODULE_1___default.a.component},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("img",{src:user.avatarURL?user.avatarURL:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",alt:user.name?user.name[0]:""}),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("h3",null,user.name),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("h5",null,user.id&&"@".concat(user.id.substring(0,15)))))};UserHeader.__docgenInfo={description:"",methods:[],displayName:"UserHeader"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/UserHeader/index.js"]={name:"UserHeader",docgenInfo:UserHeader.__docgenInfo,path:"src/components/UserHeader/index.js"})},78:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return UserList});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),_index_module_css__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(304),_index_module_css__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_index_module_css__WEBPACK_IMPORTED_MODULE_1__),UserList=function UserList(_ref){var _ref$state=_ref.state,_ref$state$room=_ref$state.room,room=void 0===_ref$state$room?{}:_ref$state$room,_ref$state$users=_ref$state.users,users=void 0===_ref$state$users?[]:_ref$state$users,setFirstName=_ref.actions.setFirstName;return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("ul",{className:_index_module_css__WEBPACK_IMPORTED_MODULE_1___default.a.component},room.users.map(function(user){return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("li",{key:user,onClick:function onClick(){return setFirstName(user)}},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("img",{src:users[user]?users[user].avatar_url:"",alt:users[user]?users[user].name[0]:""}),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("p",null,users[user]?users[user].name:"?"," "),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("p",null,users[user]?users[user].full_name:"?"))}))};UserList.__docgenInfo={description:"",methods:[],displayName:"UserList"},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/UserList/index.js"]={name:"UserList",docgenInfo:UserList.__docgenInfo,path:"src/components/UserList/index.js"})}},[[320,1,2]]]);
//# sourceMappingURL=main.53258e852d6d9e2c048c.bundle.js.map